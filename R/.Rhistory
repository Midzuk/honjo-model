use_frequency <- read_csv("use_frequency.csv", locale = locale(encoding = "cp932")) %>%
select("age",
"公民館",
"市民活動施設",
"文化施設",
"スポーツ施設",
"産業振興施設",
"図書館",
"資料館等",
"児童施設",
"病院",
"スーパー") %>%
gather(key = "type", value = "use_frequency", -age)
use_frequency <- read_csv("use_frequency.csv")
View(use_frequency)
View(use_frequency)
# 施設利用頻度
use_frequency <- read_csv("use_frequency.csv", locale = locale(encoding = "cp932")) %>%
select("age",
"公民館",
"市民活動施設",
"文化施設",
"スポーツ施設",
"産業振興施設",
"図書館",
"資料館等",
"児童施設",
"病院",
"スーパー")
library(tidyverse)
library(magrittr)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code)
mesh_codes <- mesh[,1]
# 施設利用頻度
use_frequency <- read_csv("use_frequency.csv") %>%
select("age",
"kominkan",
"shiminkatsudo",
"bunka",
"sports",
"sangyoshinko",
"toshokan",
"shiryokanto",
"jido",
"byoin",
"super") %>%
gather(key = "type", value = "use_frequency", -age)
View(use_frequency)
# 公共施設
public_facility <- read_csv("public_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
View(public_facility)
# 医療施設
medical_facility <- read_csv("medical_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
# 市外または病院以外利用率
other_medical_facility_rate <- 0.576
# 商業施設
commercial_facility <- read_csv("commercial_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
# 市外利用率
other_medical_facility_rate <- 0.225
# 大円距離
great_circuler_distance <- function(lon1, lat1, lon2, lat2){
f <- function(x){
x * pi / 180
}
6378137 * acos(sin(f(lat1)) * sin(f(lat2)) + cos(f(lat1)) * cos(f(lat2)) * cos(f(lon1) - f(lon2)))
}
View(commercial_facility)
mesh
public_facility
# 施設緯度経度
public_facility_lonlat <- public_facility %>%
select(type, num, longitude, latitude)
# 施設緯度経度
public_facility_lonlat <- public_facility %>%
select(type, num, longitude, latitude)
medical_facility_lonlat <- medical_facility %>%
select(type, num, longitude, latitude)
commercial_facility <- commercial_facility %>%
select(type, num, longitude, latitude)
View(commercial_facility)
public_facility_lonlat + medical_facility_lonlat
facility_lonlat <- public_facility_lonlat %>%
add_row(medical_facility_lonlat) %>%
add_row(commercial_facility_lonlat)
facility_lonlat <- public_facility_lonlat %>%
add_column(medical_facility_lonlat) %>%
add_column(commercial_facility_lonlat)
facility_lonlat <- public_facility_lonlat %>%
append(medical_facility_lonlat) %>%
add_column(commercial_facility_lonlat)
facility_lonlat <- bind_rows(public_facility_lonlat,
medical_facility_lonlat,
commercial_facility
)
facility_lonlat
write_csv(facility_lonlat, "facility_lonlat")
write_csv(facility_lonlat, "facility_lonlat.csv")
write_csv(mesh, "mesh_honjo.csv")
distance
distance <- read_csv("distance.csv")
distance
distance$distance
View(distance)
View(mesh)
View(medical_facility_lonlat)
View(commercial_facility)
View(medical_facility_lonlat)
View(medical_facility)
# 公共施設
public_facility <- read_csv("public_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
# 医療施設
medical_facility <- read_csv("medical_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
# 市外または病院以外利用率
other_medical_facility_rate <- 0.576
# 商業施設
commercial_facility <- read_csv("commercial_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100)
# 市外利用率
other_medical_facility_rate <- 0.225
View(medical_facility)
View(commercial_facility)
# 公共施設
public_facility <- read_csv("public_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
# 医療施設
medical_facility <- read_csv("medical_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
# 市外または病院以外利用率
other_medical_facility_rate <- 0.576
# 商業施設
commercial_facility <- read_csv("commercial_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
# 市外利用率
other_medical_facility_rate <- 0.225
distance <- read_csv("distance.csv") %>%
nest(-type)
distance[1]
distance[,1]
distance[1,]
distance[1,]$data
distance <- read_csv("distance.csv") %>%
nest(-type, -num)
distance <- read_csv("distance.csv") %>%
nest(-type-num)
distance <- read_csv("distance.csv") %>%
nest(-type)
iris
iris %>%
split(.$Species)
a <- iris %>%
split(.$Species)
a
iris
distance <- read_csv("distance.csv") %>%
split(type)
distance <- read_csv("distance.csv") %>%
split(type)
distance <- read_csv("distance.csv")
distance <- read_csv("distance.csv") %>%
split(type)
distance <- read_csv("distance.csv") %>%
split(.$type)
View(distance)
distance
imap(iris, ~ sprintf("%s is %s", .y, class(.x)))
imap(iris, ~ sprintf("%s is %s", .y, class(.z)))
imap(iris, ~ sprintf("%s is %s", .y, class(.x)))
imap(iris, ~ sprintf("%s is %s", .y, class(.)))
imap(iris, ~ sprintf("%s is %s", ., class(.)))
imap(iris, ~ sprintf("%s is %s", .y, class(.)))
imap(iris, ~ sprintf("%s is %s", .y, class(.x)))
View(a)
distance[1]
View(public_facility)
distance$bunka
# 公共施設
public_facility <- read_csv("public_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
View(public_facility_lonlat)
View(public_facility)
public_facility_type <- public_facility %>%
nest(-type) %>%
select(type)
View(public_facility_type)
public_facility_type <- public_facility %>%
nest(-type) %>%
pull(type)
View(public_facility_lonlat)
View(public_facility)
public_facility_type
distance
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.$mesh_code))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .$mesh_code))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(split(.x, .$mesh_code))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .f$mesh_code))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .$mesh_code))
distance
min(1,2)
min(1,2,3)
min(c(1,2,3))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .$mesh_code) %>%
summarise(distance = min(distance)))
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .$mesh_code) %>%
map(~ filter(., distance == min(distance))))
View(distance)
View(mesh)
View(population_2015)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code)　%>%
split(.$mesh_code)
population_2015 %<>%
gather(key = age, value = population, -mesh_code)　%>%
mesh_codes <- mesh[,1]
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code)　%>%
mesh_codes <- mesh[,1]
population_2015 %<>%
gather(key = age, value = population, -mesh_code)
population_2015 %<>%
gather(key = age, value = population, -mesh_code)
population_2015 %>%
split(.$mesh_code)
population_2015 %<>%
gather(key = age, value = population, -mesh_code) %>%
split(.$mesh_code)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code) %>%
split(.$mesh_code)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code)
population_2015 <- population_2015 %>%
split(.$mesh_code)
read_csv("distance.csv")
View(population_2015)
library(magrittr)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code) %>%
split(.$mesh_code)
View(population_2015)
population_2015$`5439104543`
population_2015$`5439104543`$age
population_2015$`5439104543`[[1]]
View(population_2015)
# 施設利用頻度
use_frequency <- read_csv("use_frequency.csv") %>%
select("age",
"kominkan",
"shiminkatsudo",
"bunka",
"sports",
"sangyoshinko",
"toshokan",
"shiryokanto",
"jido",
"byoin",
"super") %>%
gather(key = "type", value = "use_frequency", -age) %>%
split(type)
View(use_frequency)
# 施設利用頻度
use_frequency <- read_csv("use_frequency.csv") %>%
select("age",
"kominkan",
"shiminkatsudo",
"bunka",
"sports",
"sangyoshinko",
"toshokan",
"shiryokanto",
"jido",
"byoin",
"super") %>%
gather(key = "type", value = "use_frequency", -age) %>%
split(.$type)
View(use_frequency)
facilty_type
facility_type
library(tidyverse)
library(magrittr)
# 2015年時点メッシュ人口およびメッシュの緯度経度
population_2015 <- read_csv("population_2015.csv")
mesh <- read_csv("mesh.csv") %>%
inner_join(population_2015, by = "mesh_code") %>%
select("mesh_code", "longitude", "latitude")
population_2015 %<>%
gather(key = age, value = population, -mesh_code) %>%
split(.$mesh_code)
mesh_codes <- mesh[,1]
# 施設利用頻度
use_frequency <- read_csv("use_frequency.csv") %>%
select("age",
"kominkan",
"shiminkatsudo",
"bunka",
"sports",
"sangyoshinko",
"toshokan",
"shiryokanto",
"jido",
"byoin",
"super") %>%
gather(key = "type", value = "use_frequency", -age) %>%
split(.$type)
facility_type <- use_frequency %>%
nest(-type)
facility_type <- facility_type[,1]
# 公共施設
public_facility <- read_csv("public_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
public_facility_type <- public_facility %>%
nest(-type) %>%
pull(type)
# 医療施設
medical_facility <- read_csv("medical_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
# 市外または病院以外利用率
other_medical_facility_rate <- 0.576
# 商業施設
commercial_facility <- read_csv("commercial_facility.csv") %>%
mutate(use_rate = as.numeric(sub("%", "", use_rate)) / 100) %>%
select(-name)
# 市外利用率
other_medical_facility_rate <- 0.225
# 施設緯度経度
public_facility_lonlat <- public_facility %>%
select(type, num, longitude, latitude)
medical_facility_lonlat <- medical_facility %>%
select(type, num, longitude, latitude)
commercial_facility <- commercial_facility %>%
select(type, num, longitude, latitude)
facility_lonlat <- bind_rows(public_facility_lonlat,
medical_facility_lonlat,
commercial_facility
)
distance <- read_csv("distance.csv") %>%
split(.$type) %>%
map(~ split(.x, .$mesh_code) %>%
map(~ filter(., distance == min(distance))))
facility_type
use_frequency
use_frequency[1]
use_frequency[[1]]
use_frequency
pull(use_frequency)
names(use_frequency)
for (t in facility_type) {
}
facility_type <- names(use_frequency)
for (t in facility_type) {
}
for (t in facility_type) {
print(1)
}
mesh_codes
names(mesh)
pull(mesh)
mesh$mesh_code
mesh_codes <- mesh$mesh_code
a <- "mesh_code"
mesh$a
list(distance, use_frequency)
pmap_chr(list("I", "am", letters), ~ paste(..1, ..2, ..3))
pmap_chr(list("I", "am", letters), ~ paste(..1, ..2, ..4))
pmap_chr(list("I", "am", letters), ~ paste(..1, ..2, ..3))
pmap_chr(list("I", letters, letters), ~ paste(..1, ..2, ..3))
user <- list(distance, use_frequency) %>%
pmap(~ )
user <- list(distance, use_frequency) %>%
pmap(~ print(1))
View(facility_lonlat)
facility
View(facility_lonlat)
View(medical_facility)
facility_user <- facility_lonlat %>%
mutate(user = NA)
View(facility_user)
facility_user <- facility_lonlat %>%
mutate(user = NA) %>%
split(type)
View(facility_user)
facility_user <- facility_lonlat %>%
mutate(user = NA) %>%
split(type)
View(facility_user)
facility_user <- facility_lonlat %>%
mutate(user = NA) %>%
split(.$type)
View(facility_user)
facility_user$bunka
length(facility_user$bunka)
nrow(facility_user$bunka)
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(~ .$user <- 1))
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
x$user <- 1
}))
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
print(x$num)
}))
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
print(..1[[x]])
}))
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
print(..1[x])
}))
facility_user$bunka
facility_user$bunka[1]
facility_user$bunka[,1]
facility_user$bunka[1,]
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
print(..1[x,]$num)
}))
facility_user$bunka[1,]
facility_user$bunka[1,]$num
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
..1[x,]$user <- 1
}))
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
..1[x,]$user <- 1
}))
View(facility_user)
View(facility_user)
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
print(nrow(..1))
}))
facility_user$bunka$num
facility_user$bunka$user
facility_user$bunka$user[1]
facility_user$bunka$user[2]
list(facility_user, distance, use_frequency) %>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
..1$user[x] <- 1
}))
list(facility_user, distance, use_frequency) %<>%
pmap(~ 1 : nrow(..1) %>%
map(function(x) {
..1$user[x] <- 1
}))
